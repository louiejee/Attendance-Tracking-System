{% extends 'base.html' %}

{% block content %}
<div class="w3-row" style="text-align: right; margin-right: 20px; margin-top: 10px;">
    <button class="w3-button w3-teal" onclick="window.location.href='/attendance'">VIEW ATTENDANCE</button>
    <button class="w3-button w3-teal" onclick="window.location.href='/add'">+ADD</button>
    <button class="w3-button w3-teal" onclick="window.location.href='/'">LOGOUT</button>
</div>

<div class="w3-container w3-padding w3-round-xlarge w3-card-4" style="margin-top: 20px;">
    <div class="w3-responsive w3-padding">
        <table class="w3-table-all">
            <thead>
                <tr class="w3-light-grey">
                    <th>IDNO</th>
                    <th>LASTNAME</th>
                    <th>FIRSTNAME</th>
                    <th>COURSE</th>
                    <th>LEVEL</th>
                    <th>TIME LOGGED</th>
                </tr>
            </thead>
            <tbody id="student-list">
                <!-- Student records will be displayed here -->
            </tbody>
        </table>
    </div>
</div>

<canvas id="qr-canvas" style="display:none"></canvas>

<script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.min.js"></script>

<script>
    // Function to format date and time
    function formatDateTime(dateString) {
        const date = new Date(dateString);
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const year = date.getFullYear();

        let hours = date.getHours();
        const minutes = String(date.getMinutes()).padStart(2, '0');
        const ampm = hours >= 12 ? 'PM' : 'AM';

        hours = hours % 12;
        hours = hours ? hours : 12;

        return `${year}-${month}-${day} ${hours}:${minutes} ${ampm}`;
    }

    // Load attendance from server
    function loadAttendance() {
        fetch('/api/attendance')
            .then(response => response.json())
            .then(attendanceList => {
                const studentListContainer = document.getElementById('student-list');
                studentListContainer.innerHTML = '';

                attendanceList.forEach(function(record) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${record.idno}</td>
                        <td>${record.lastname}</td>
                        <td>${record.firstname}</td>
                        <td>${record.course}</td>
                        <td>${record.level}</td>
                        <td>${formatDateTime(record.time_logged)}</td>
                    `;
                    studentListContainer.appendChild(row);
                });
            });
    }

    // Load attendance on page load
    window.onload = function() {
        loadAttendance();
    };
</script>


{% endblock %}
